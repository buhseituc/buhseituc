(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{c892:function(t,e,i){"use strict";i("e6dc")},cf66:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"flex flex-start"},[i("div",{staticClass:"fullscreen"},[i("div",{staticClass:"fit"},[i("q-carousel",{directives:[{name:"touch-swipe",rawName:"v-touch-swipe.mouse",value:t.onSwipeCarousel,expression:"onSwipeCarousel",modifiers:{mouse:!0}}],ref:"albumCarousel",staticClass:"fit bg-dark text-white",attrs:{"keep-alive":!0,"keep-alive-max":10,autoplay:t.autoplay,swipeable:"",animated:"",arrows:""},on:{transition:t.afterEnterSlide},scopedSlots:t._u([{key:"control",fn:function(){return[i("q-carousel-control",{staticClass:"text-white rounded-borders carousel-autoplay",attrs:{position:"bottom-left",offset:[12,16]}},[i("q-toggle",{attrs:{dense:"",dark:"",color:"orange",label:"Auto"},model:{value:t.autoplay,callback:function(e){t.autoplay=e},expression:"autoplay"}})],1),i("q-carousel-control",{staticClass:"q-gutter-xs flex flex-center",attrs:{position:"top",offset:[10,10]}},[i("q-btn",{attrs:{round:"",dense:"",color:"mask-white",icon:"keyboard_arrow_up"},on:{click:t.goToPrevAlbum}})],1),i("q-carousel-control",{staticClass:"q-gutter-xs flex flex-center",attrs:{position:"bottom",offset:[100,14]}},[i("q-btn",{attrs:{round:"",dense:"",color:"mask-white",icon:"keyboard_arrow_down"},on:{click:t.goToNextAlbum}})],1)]},proxy:!0}]),model:{value:t.slideName,callback:function(e){t.slideName=e},expression:"slideName"}},t._l(t.slideImgs,(function(e,s){return i("q-carousel-slide",{key:s,staticClass:"slide-container column no-wrap flex-center q-pa-none",attrs:{name:s}},[i("div",{staticClass:"row fit justify-start items-center"},[i("q-img",{staticStyle:{"max-height":"100%"},attrs:{src:e.imgUrl}})],1),e.title?i("div",{staticClass:"q-pa-sm absolute-top bg-mask text-mask text-center",style:t.titleStyleObj},[i("div",{staticClass:"ellipsis-2-lines text-h6 text-weight-medium",staticStyle:{"word-break":"break-all"}},[i("span",{staticClass:"text-deep-orange-3"},[t._v("\n                "+t._s(e.imgIdx+1)+"\n              ")]),t._v("\n              /\n              "),i("span",{staticClass:"text-deep-orange"},[t._v("\n                "+t._s(e.imgTotal)+"\n              ")]),t._v("\n              "+t._s(e.title)+"\n            ")])]):t._e()])})),1)],1),t.isFetchingItems?i("div",{staticClass:"q-pa-md fixed-center no-pointer-events"},[i("q-circular-progress",{attrs:{indeterminate:"",size:"md",color:"primary"}})],1):t._e(),i("q-page-sticky",{attrs:{position:"top-right",offset:[12,14]}},[i("q-btn",{attrs:{round:"",icon:"exit_to_app",color:"mask-white",padding:"5px"},on:{click:t.exitPreview}})],1),i("q-page-sticky",{attrs:{position:this.vertical?"bottom-right":"top-left",offset:[12,14]}},[i("div",{staticClass:"column items-center q-gutter-y-md"},[i("q-fab",{attrs:{color:"mask-white",icon:"menu",direction:this.vertical?"up":"down",padding:"5px"},model:{value:t.showFabActions,callback:function(e){t.showFabActions=e},expression:"showFabActions"}},[i("q-fab-action",{attrs:{color:t.favoriteIconColor,"text-color":t.favoriteIconColor,icon:t.favoriteIcon,padding:"5px"},on:{click:t.toggleFavorite}}),i("q-fab-action",{attrs:{color:"mask-white","text-color":"orange",icon:"play_arrow",padding:"5px"},on:{click:t.launchDetail}})],1)],1)])],1)])},a=[],o=i("9632"),r=i.n(o),n=(i("a79d"),i("e6cf"),i("5319"),{name:"Album",data(){return{previewItems:{},fetchedItems:[],isFetchingItems:!1,unwatchedHashIds:[],slideImgs:{},slideName:void 0,autoplay:!1,isFavoriteCache:{},isFavorite:!1,favoriteIconDefault:"favorite_border",favoriteIconActive:"favorite",favoriteIconColorDefault:"mask-white",favoriteIconColorActive:"mask-red-8",showFabActions:!0}},computed:{username(){const t=this.$store.state.api.userAccount||{};return t.username||this.$t("Guest")},vertical(){return this.$q.screen.height>=this.$q.screen.width},currentSlide(){return this.slideImgs[this.slideName]||{}},currentItem(){const t=this.currentSlide.hashId;return this.previewItems[t]||{}},titleStyleObj(){return{opacity:.3}},favoriteIcon(){return this.isFavorite?this.favoriteIconActive:this.favoriteIconDefault},favoriteIconColor(){return this.isFavorite?this.favoriteIconColorActive:this.favoriteIconColorDefault}},created(){this.processGetPreviewItems().then((t=>{this.slideName=this.getFirstAlbumSlideName()})).catch((t=>{const e=JSON.stringify(t);console.log(`Process failed: ${e}`)})).finally((t=>{this.isFetchingItems=!1}))},mounted(){this.initFavorite(),this.$gtag.event("enter_album",{event_category:"enter_page",event_label:this.username})},methods:{async processGetPreviewItems(){this.isFetchingItems=!0;const t=await this.$apc.authApi("video_item/getpreviewitems",{limit:3});return this.fetchedItems=t.list||[],this.$apc.utils.shuffleArray(this.fetchedItems),this.fetchedItems.forEach(((t,e)=>{this.unwatchedHashIds.push(t.hash_id),this.$set(this.previewItems,t.hash_id,t);const i=this.getItemPicFullUrls(t)||[],s=i.length;i.forEach(((e,i)=>{const a=this.getSlideKey(t,i),o={hashId:t.hash_id,title:t.title,imgIdx:i,imgTotal:s,imgUrl:e};this.$set(this.slideImgs,a,o)}))})),this.isFetchingItems=!1,this.fetchedItems},getItemMeta(t){return t.meta||{}},getItemWidth(t){const e=this.getItemMeta(t),i=!e.width||e.width<1?640:e.width;return i},getItemHeight(t){const e=this.getItemMeta(t),i=!e.height||e.height<1?360:e.height;return i},getItemRatio(t){return this.getItemWidth(t)/this.getItemHeight(t)},checkItemIsPortrait(t){return this.getItemHeight(t)>this.getItemWidth(t)},getItemPicFullUrls(t){const e=this.getItemMeta(t);return e.pic_full_urls||[]},getSlideKey(t,e){if(t.hash_id&&!(e<0))return t.hash_id+"_"+e},getFirstAlbumSlideName(){const t=Object.keys(this.previewItems)||[];if(t.length<1)return;const e=t[0],i=this.previewItems[e]||{};return this.getSlideKey(i,0)},getPrevAlbumSlideName(){const t=Object.keys(this.previewItems)||[];if(t.length<1)return;const e=this.currentSlide.hashId,i=t.indexOf(e);if(i<0)return;const s=t[i-1],a=this.previewItems[s]||{};return this.getSlideKey(a,0)},getNextAlbumSlideName(){const t=Object.keys(this.previewItems)||[];if(t.length<1)return;const e=this.currentSlide.hashId,i=t.indexOf(e);if(i<0)return;const s=t[i+1],a=this.previewItems[s]||{};return this.getSlideKey(a,0)},afterEnterSlide(t,e){this.initFavorite();const i=this.currentSlide.hashId;this.unwatchedHashIds.includes(i)&&(this.unwatchedHashIds=this.unwatchedHashIds.filter((t=>t!==i))),this.unwatchedHashIds.length<1&&this.processGetPreviewItems().catch((t=>{const e=JSON.stringify(t);console.log(`Process failed: ${e}`)})).finally((t=>{this.isFetchingItems=!1}))},goToPrevAlbum(){const t=this.getPrevAlbumSlideName();t&&this.$refs.albumCarousel.goTo(this.getPrevAlbumSlideName())},goToNextAlbum(){const t=this.getNextAlbumSlideName();t&&this.$refs.albumCarousel.goTo(this.getNextAlbumSlideName())},onSwipeCarousel(t){let{event:e}=t,i=r()(t,["event"]);switch(i.direction){case"up":this.goToNextAlbum();break;case"down":this.goToPrevAlbum();break}},initFavorite(){const t=this.currentItem.hash_id;t&&(void 0===this.isFavoriteCache[t]?this.$apc.authApi("video_favorite/isfavorite",{hash_id:t}).then((e=>{this.isFavorite=!!e.is_favorite,this.isFavoriteCache[t]=this.isFavorite})).catch((t=>{const e=JSON.stringify(t);console.log(`Process failed: ${e}`)})):this.isFavorite=!!this.isFavoriteCache[t])},toggleFavorite(){this.showFabActions=!0;const t=this.currentItem.hash_id;if(!t)return;const e=this.isFavorite?this.$t("Unfavorite successfully"):this.$t("Add to favorites successfully"),i=this.isFavorite?"favorite_border":"favorite",s=this.$q.platform.is.mobile?"center":"top-right",a=this.isFavorite?"video_favorite/remove":"video_favorite/add";this.$apc.authApi(a,{hash_id:t}).then((a=>{this.$apc.notifySuccess(e,s,1500,i),this.isFavorite=!this.isFavorite,this.isFavoriteCache[t]=this.isFavorite})).catch((t=>{const e=JSON.stringify(t);console.log(`Process failed: ${e}`)}))},launchDetail(){this.showFabActions=!0;const t=this.currentItem.hash_id;t&&this.$router.push({name:"detail",params:{itemId:t}}).catch((t=>{console.log(t)}))},exitPreview(){window.history.length>2?this.$router.go(-1):this.$router.replace("/").catch((t=>{console.log(t)}))}}}),c=n,l=(i("c892"),i("2877")),h=i("9989"),u=i("880c"),d=i("62cd"),m=i("068f"),g=i("32a7"),f=i("9564"),v=i("9c40"),p=i("58ea"),I=i("de5e"),w=i("c294"),b=i("72db"),y=i("12c5"),x=i("eebe"),_=i.n(x),F=Object(l["a"])(c,s,a,!1,null,null,null);e["default"]=F.exports;_()(F,"components",{QPage:h["a"],QCarousel:u["a"],QCarouselSlide:d["a"],QImg:m["a"],QCarouselControl:g["a"],QToggle:f["a"],QBtn:v["a"],QCircularProgress:p["a"],QPageSticky:I["a"],QFab:w["a"],QFabAction:b["a"]}),_()(F,"directives",{TouchSwipe:y["a"]})},e6dc:function(t,e,i){}}]);